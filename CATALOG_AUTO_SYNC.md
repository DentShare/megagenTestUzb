# Автоматическая синхронизация каталога

## Описание

Бот автоматически синхронизирует каталог продукции из Excel файла при каждом перезапуске. Это означает, что после обновления Excel таблицы достаточно просто перезапустить бота, и новый каталог будет загружен автоматически.

## Как это работает

1. При старте бота (в `main.py`) проверяется настройка `CATALOG_AUTO_SYNC`
2. Если включено (по умолчанию `true`), бот ищет Excel файл с каталогом
3. Загружает данные из Excel и обновляет `catalog_data.py`
4. Handlers импортируются ПОСЛЕ загрузки каталога, чтобы использовать актуальные данные

## Настройка

### Включение/выключение автоматической синхронизации

В файле `.env` можно добавить:

```env
# Включить автоматическую синхронизацию (по умолчанию: true)
CATALOG_AUTO_SYNC=true

# Указать конкретный файл Excel (опционально)
CATALOG_EXCEL_FILE=catalog_template.xlsx
```

Если `CATALOG_AUTO_SYNC=false`, автоматическая синхронизация будет отключена, и бот будет использовать существующий `catalog_data.py`.

### Автоматический поиск файла

Если `CATALOG_EXCEL_FILE` не указан, бот автоматически ищет файл в следующем порядке:
1. `catalog_template.xlsx`
2. `Megagenbot.xlsx`
3. `catalog.xlsx`

## Использование

### Обновление каталога

1. Откройте Excel файл (например, `catalog_template.xlsx`)
2. Внесите изменения в каталог
3. Сохраните файл
4. Перезапустите бота

При следующем запуске бот автоматически:
- Загрузит данные из Excel
- Обновит `catalog_data.py`
- Использует новый каталог в работе

### Ручная загрузка (если нужно)

Если нужно загрузить каталог вручную без перезапуска бота:

```bash
python load_catalog_from_excel.py catalog_template.xlsx
```

## Логирование

При загрузке каталога в логах будет видно:
- Какой файл используется
- Сколько товаров загружено
- Статистику по категориям
- Успешное завершение или ошибки

Пример лога:
```
INFO - Found catalog file: catalog_template.xlsx
INFO - Loading catalog from: catalog_template.xlsx
INFO - Loaded: 150 items, Skipped: 5 rows
INFO - ✅ Catalog loaded and synchronized successfully
```

## Обработка ошибок

Если при загрузке каталога произошла ошибка:
- Бот продолжит работу с существующим `catalog_data.py`
- Ошибка будет залогирована
- Бот не упадет из-за проблем с каталогом

## Технические детали

- Загрузка происходит в `services/catalog_loader.py`
- Используется функция `load_catalog_from_excel()` из `load_catalog_from_excel.py`
- Модуль `catalog_data` перезагружается после обновления (если был импортирован ранее)
- Handlers импортируются после загрузки каталога для гарантии актуальных данных
