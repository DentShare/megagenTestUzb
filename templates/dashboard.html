<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Megagen Bot Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        .stat-card.new { border-left: 4px solid #2196F3; }
        .stat-card.assembly { border-left: 4px solid #FF9800; }
        .stat-card.delivering { border-left: 4px solid #9C27B0; }
        .stat-card.delivered { border-left: 4px solid #4CAF50; }
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-card h3 {
            margin-bottom: 20px;
            color: #333;
        }
        .orders-table {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f9f9f9;
            font-weight: 600;
            color: #666;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-new { background: #E3F2FD; color: #1976D2; }
        .status-assembly { background: #FFF3E0; color: #F57C00; }
        .status-ready_for_pickup { background: #F3E5F5; color: #7B1FA2; }
        .status-delivering { background: #E1BEE7; color: #6A1B9A; }
        .status-delivered { background: #E8F5E9; color: #388E3C; }
        .urgent {
            color: #F44336;
            font-weight: bold;
        }
        .auto-refresh {
            text-align: right;
            margin-bottom: 10px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Megagen Bot Dashboard</h1>
        
        <div class="auto-refresh">
            –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdate"></span>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</h3>
                <div class="value">{{ total_orders }}</div>
            </div>
            <div class="stat-card new">
                <h3>–ù–æ–≤—ã–µ</h3>
                <div class="value">{{ new_orders }}</div>
            </div>
            <div class="stat-card assembly">
                <h3>–í —Å–±–æ—Ä–∫–µ</h3>
                <div class="value">{{ assembly_orders }}</div>
            </div>
            <div class="stat-card delivering">
                <h3>–í –¥–æ—Å—Ç–∞–≤–∫–µ</h3>
                <div class="value">{{ delivering_orders }}</div>
            </div>
            <div class="stat-card delivered">
                <h3>–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</h3>
                <div class="value">{{ delivered_today }}</div>
            </div>
            <div class="stat-card">
                <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                <div class="value">{{ active_users }}/{{ total_users }}</div>
            </div>
            <div class="stat-card">
                <h3>–ö–ª–∏–Ω–∏–∫</h3>
                <div class="value">{{ total_clinics }}</div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-card">
                <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>–ó–∞–∫–∞–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h3>
                <canvas id="dailyChart"></canvas>
            </div>
        </div>
        
        <div class="orders-table">
            <h3 style="margin-bottom: 20px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                        <th>–ö–ª–∏–Ω–∏–∫–∞</th>
                        <th>–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏</th>
                        <th>–°–æ–∑–¥–∞–Ω</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in recent_orders %}
                    <tr>
                        <td>#{{ order.id }}</td>
                        <td>
                            <span class="status-badge status-{{ order.status }}">
                                {{ order.status }}
                            </span>
                            {% if order.is_urgent %}
                            <span class="urgent">‚ö°</span>
                            {% endif %}
                        </td>
                        <td>{{ order.manager }}</td>
                        <td>{{ order.clinic }}</td>
                        <td>{{ order.delivery_type }}</td>
                        <td>{{ order.created_at }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // –ì—Ä–∞—Ñ–∏–∫ —Å—Ç–∞—Ç—É—Å–æ–≤
        const statusData = {{ status_stats|safe }};
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(statusData),
                datasets: [{
                    data: Object.values(statusData),
                    backgroundColor: [
                        '#2196F3',
                        '#FF9800',
                        '#9C27B0',
                        '#E1BEE7',
                        '#4CAF50'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true
            }
        });
        
        // –ì—Ä–∞—Ñ–∏–∫ –ø–æ –¥–Ω—è–º
        const dailyData = {{ daily_stats|safe }};
        const dailyCtx = document.getElementById('dailyChart').getContext('2d');
        new Chart(dailyCtx, {
            type: 'line',
            data: {
                labels: Object.keys(dailyData),
                datasets: [{
                    label: '–ó–∞–∫–∞–∑–æ–≤',
                    data: Object.values(dailyData),
                    borderColor: '#2196F3',
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        function updateTime() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ru-RU');
        }
        updateTime();
        setInterval(() => {
            location.reload();
        }, 30000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    </script>
</body>
</html>
